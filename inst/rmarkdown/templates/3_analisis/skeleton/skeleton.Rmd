---
title: 'Analisis transversal descriptivo . Fecha de corte:  `r params$bd.dindex1`'
author: "Jordi Real & Rai Puig"
website: "https://github.com/USR-DAPCAT/"

date: "`r format(Sys.time(), '%d %B, %Y')`"


output:
  html_document:
    df_print: paged
    toc: true
    toc_float: true
    fig_caption: true
    css: logos_css/usr_styles.css
  pdf_document: default
  word_document: default

params:
  dir_dades_desti: "dades"
  ANY: '20181231'
---

&nbsp;
<script>
   $(document).ready(function() {
     $head = $('#header');
     $head.prepend('<img src=\"https://www.idiapjgol.org/images/logo.png\" style=\"float: right ;width: 130px;\"/>')
     $head.prepend('<img src=\"https://avatars2.githubusercontent.com/u/57066591?s=200&v=4\" style=\"margin-left:25% ;width: 80px;\"/>')
     $head.prepend('<img src=\"logos_css/logoDAP_Cat.png\" style=\"float: left:1;width: 185px;\"/>')
   });
</script>


<div class="watermark">DRAFT</div>

****

## 0. Estat:

**agregacions i part global descriptiva**


&check; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX <br/>
 
**Pendents**

&check; XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX <br/>


## Fase Preparacio: cataleg+conductor+link_funcions


```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, include=F,size="huge")

# Notació no cientifica dels numeros
options(scipen = 999)

gc()




#######################################################
#
#
# libreries i funcions
library("dplyr")
library("lubridate")
library("compareGroups")
library("sjPlot")
library("tableone")
library("magrittr")
library("ggplot2")
library("scales")
#
#
# Descarregar funcions github -
link_source<-paste0("https://github.com/jrealgatius/Stat_codis/blob/master/funcions_propies.R","?raw=T")
devtools::source_url(link_source)

conductor_codis<-here::here("CATALEG.xlsx")
dt_cataleg<-readxl::read_excel(conductor_codis,col_types = "text")%>% select(cod,domini,agr,agr_Farmac,DM2)

#
#
#
#######################################################


```


```{r llegir, include = FALSE}
# Llegir plana
#
dades<-readRDS(here::here(params$dir_dades_desti,"dt_plana2.rds")) %>% as_tibble()
#
```


## Etiquetar_valors_conductor+recodificacions_conductor+missings_conductor+factoritzar.NO.SI

```{r etiquetes1}

#dades<-dades%>%mutate(exclusio1=DG.Exclusion)
dades<-dades%>%mutate(exclusio2=ifelse(dtindex==sortida & situacio!="A",1,0))

dades<-mutate_at(dades, vars( starts_with("exclusio") ), funs( if_else(.==0  | is.na(.)  ,0,1)))


#Recodificar automaticament a partir del Conductor!
#dades<-recodificar(dades,taulavariables =conductor,"recode",missings = T)

#Etquetem (Si/No)  a partir del Conductor!
dades<- dades %>% mutate_at(vars(starts_with("DG.")), ~if_else(.==1,"Yes","No",missing = "No")) 
dades<- dades %>% mutate_at(vars(starts_with("EVENT.")), ~if_else(.==1,"Yes","No",missing = "No")) 
dades<- dades %>% mutate_at(vars(starts_with("FF.")), ~if_else(.==1,"Yes","No",missing = "No")) 
dades<- dades %>% mutate_at(vars(starts_with("FP.")), ~if_else(.==1,"Yes","No",missing = "No")) 

#
#
#
#
#Etquetem  VALORS! de les VAR  a partir del Conductor!
#dades<-etiquetar_valors(dt=dades,variables_factors=conductor,fulla="etiquetes",camp_etiqueta="etiqueta1")


#Apliquem que surtin els MISSINGS a les TAULES , a partir del CONDUCTOR!
#dades<-dades%>%mutate_at(extreure.variables("missings",conductor,dt=dades),as.factor)


#Cat referencia
#dades<-dades %>% refcat(conductor = conductor,ref="refcat")


```
## 1. Flow chart + Etiquetar_Nom_Variables_conductor

```{r Flow chart, include=T}

#dades




Flowchart<-diagramaFlowchart1G(
  pob_lab1=c("Pob Initial","Pob Final"),
  pob1=c(30,length(dades$idp)),
  exc1=c(30-length(dades$idp)),
  exc_lab1=c('data_index:31.12.2018 > entrada or data_index:31.12.2018 < sortida  '),
  colors=c('white','grey'),
  forma=c('box','box')) 
        
  



Flowchart







```



## 2. Descriptiva Exploratoria General. Todas las variables.


# Títol de primer nivell
## Títol de segon nivell
### Títol de tercer nivell
*Text en cursiva*
**Text en negreta**
***Text en cursiva i negreta***
L'equacio seria $e=mc^2$



```{r descrTable General:resultats1, include=T}




descrTable(DG.DM2~., dades,method = 2,Q1=0,Q3=1,extra.labels = c("","","")) %>% export2md()




```



```
&nbsp;
<hr />
<p style="text-align: center;">A work by $Jordi Real$ $Rai Puig$ </a></p>
<p style="text-align: center;">$Llepali System$ </a></p>
<p style="text-align: center;"><span style="color: #808080;"><em><https://github.com/USR-DAPCAT/></em></span></p>


